# Что поменяется?

Основное изменение касается структуры хранения данных о действиях по кандидатам на мультивакансии и дочерних вакансиях. Ранее, все действия по мультивакансии дублировались на дочерние вакансии. После релиза действия по мультивакансии будут отражаться только в самой мультивакансии, а на дочерних вакансиях будут фиксироваться действия только в случае «отщепления» (рассмотрения кандидата по конкретной вакансии).

## Изменения в API

 1. Для рассмотрения кандидата по дочерней вакансии необходимо использовать специальный [метод «отщепления»](https://github.com/huntflow/api/blob/split_applicant_to_vacancy/ru/applicants.md#splitting) 
 2. Из логов (истории работы по кандидату) убран параметр `vacancy_group_action` (по нему ранее можно было определить сделано ли действие по мультивакансии или по дочерней).
 3. В объекте `links` по кандидату ([ссылка](https://github.com/huntflow/api/blob/split_applicant_to_vacancy/ru/applicants.md#получение-списка-кандидатов)) для мультивакансии будет находиться только объект с мультивакансией и объекты с «отщепленными» дочерними вакансиями (ранее там находились и дублировались объекты по всем дочерним вакансиям независимо от их состояния).
 
## Изменения в вебхуках

 1. Из тела вебхука в блоке информации о действии по кандидату удалено поле `vacancy_group_action`:
     ```
    {
      ...
      "event": {
        ...
        "applicant_log": {
          ...
          "vacancy_group_action": 123,  # удалено
          ...
        },
        ...
       },
       ...
    }
     ```
 
 2. При выполнении действий с кандидатом по мультивакансии (родительской вакансии) теперь присылается только один вебхук по этой родительской вакансии (убрано дублирование информации по «неотщепленным» дочерним вакансиям).

#### Как определить по какой вакансии действие

Необходимо смотреть на данные о вакансии в теле вебхука (поля `parent` и `multiple`):

```
{
  ...
  "event": {
    ...
    "applicant_log":{
      ...
      "vacancy": {
         ...
         "multiple": true,
         "parent": null,
         ...
      },
      ...
    },
    ...
   },
   ...
}
```

Тип вакансии определяется по сочетаниям значений этих двух полей:

multiple | parent  | Тип вакансии
---------|---------|-------------
true     | null    | Родительская вакансия (мультивакансия)
false    | не null | Дочерняя вакансия (подвакансия)
false    | null    | Обычная вакансия

## Изменения в выгрузке базы в формате JSON

### Изменения в файле vacancies.json:

 1. В выгрузку добавлена информация о родительской вакансии (раньше выгружались только обычные и дочерние вакансии).
 2. В блок информации по вакансии добавлены поля multiple (признак родительской вакансии) и parent (идентификатор родительской вакансии):
 
    ```
    {
        "items": [
            {
              ...
              "multiple": true,
              "parent": null,
               ...
            }
        ]
    }
    ```

Тип вакансии определяется по сочетаниям значений этих двух полей:

multiple | parent  | Тип вакансии
---------|---------|-------------
true     | null    | Родительская вакансия (мультивакансия)
false    | не null | Дочерняя вакансия (подвакансия)
false    | null    | Обычная вакансия

### Именения в файле applicants.json:

 1. История по кандидату:
 
     ```
     {
       "items": [
           ...
           "logs": [
                 # вот здесь
           ],
           ...
       ]
     }
     ```
    Для мультивакансии будут находиться только объекты с действиями по мультивакансии и «отщепленными» дочерними вакансиями (ранее там находились и дублировались объекты по всем дочерним вакансиям независимо от их состояния).
 
 2. Привязка кандидата к вакансиям:
 
    ```
    {
      "items": [
          ...
          "vacancies": [
                # вот здесь
          ],
          ...
      ]
    }
    ```
    
    Для мультивакансии теперь выгружается только привязка по мультивакансии и «отщепленным» дочерним вакансиям (исчезло дублирование информации по «неотщепленным» дочерним вакансиям).